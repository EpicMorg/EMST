using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;
#if DEBUG
using System.Diagnostics;
using System.Text;
#endif
namespace EpicMorg.Tools
{
    public class StringTools
    {
        Regex numeric = new Regex("\\&\\#[0-9]{1,3}\\;");
        Regex urlhex = new Regex("(\\%[0-9A-Fa-f]{2}){2}");
        #region Chars
        private static SortedList<char, char> Chars = new SortedList<char, char>()
        {
{'\'','\''},
{'Á','Á'},
{'á','á'},
{'â','â'},
{'Â','Â'},
{'´','´'},
{'æ','æ'},
{'Æ','Æ'},
{'À','À'},
{'à','à'},
{'ℵ','ℵ'},
{'Α','Α'},
{'α','α'},
{'&','&'},
{'∧','∧'},
{'∠','∠'},
{'å','å'},
{'Å','Å'},
{'≈','≈'},
{'Ã','Ã'},
{'ã','ã'},
{'Ä','Ä'},
{'ä','ä'},
{'„','„'},
{'Β','Β'},
{'β','β'},
{'¦','¦'},
{'•','•'},
{'∩','∩'},
{'Ç','Ç'},
{'ç','ç'},
{'¸','¸'},
{'¢','¢'},
{'χ','χ'},
{'Χ','Χ'},
{'ˆ','ˆ'},
{'♣','♣'},
{'≅','≅'},
{'©','©'},
{'↵','↵'},
{'∪','∪'},
{'¤','¤'},
{'†','†'},
{'‡','‡'},
{'⇓','⇓'},
{'↓','↓'},
{'°','°'},
{'Δ','Δ'},
{'δ','δ'},
{'♦','♦'},
{'÷','÷'},
{'é','é'},
{'É','É'},
{'Ê','Ê'},
{'ê','ê'},
{'è','è'},
{'È','È'},
{'∅','∅'},
{' ',' '},
{' ',' '},
{'ε','ε'},
{'Ε','Ε'},
{'≡','≡'},
{'Η','Η'},
{'η','η'},
{'ð','ð'},
{'Ð','Ð'},
{'ë','ë'},
{'Ë','Ë'},
{'€','€'},
{'∃','∃'},
{'ƒ','ƒ'},
{'∀','∀'},
{'½','½'},
{'¼','¼'},
{'¾','¾'},
{'⁄','⁄'},
{'Γ','Γ'},
{'γ','γ'},
{'≥','≥'},
{'>','>'},
{'⇔','⇔'},
{'↔','↔'},
{'♥','♥'},
{'…','…'},
{'í','í'},
{'Í','Í'},
{'î','î'},
{'Î','Î'},
{'¡','¡'},
{'Ì','Ì'},
{'ì','ì'},
{'ℑ','ℑ'},
{'∞','∞'},
{'∫','∫'},
{'Ι','Ι'},
{'ι','ι'},
{'¿','¿'},
{'∈','∈'},
{'Ï','Ï'},
{'ï','ï'},
{'Κ','Κ'},
{'κ','κ'},
{'λ','λ'},
{'Λ','Λ'},
{'〈','〈'},
{'«','«'},
{'←','←'},
{'⇐','⇐'},
{'⌈','⌈'},
{'“','“'},
{'≤','≤'},
{'⌊','⌊'},
{'∗','∗'},
{'◊','◊'},
{'‎','‎'},
{'‹','‹'},
{'‘','‘'},
{'<','<'},
{'¯','¯'},
{'—','—'},
{'µ','µ'},
{'·','·'},
{'−','−'},
{'Μ','Μ'},
{'μ','μ'},
{'∇','∇'},
{'1','1'},
{'–','–'},
{'≠','≠'},
{'∋','∋'},
{'¬','¬'},
{'∉','∉'},
{'⊄','⊄'},
{'ñ','ñ'},
{'Ñ','Ñ'},
{'Ν','Ν'},
{'ν','ν'},
{'ó','ó'},
{'Ó','Ó'},
{'Ô','Ô'},
{'ô','ô'},
{'Œ','Œ'},
{'œ','œ'},
{'ò','ò'},
{'Ò','Ò'},
{'‾','‾'},
{'ω','ω'},
{'Ω','Ω'},
{'Ο','Ο'},
{'ο','ο'},
{'⊕','⊕'},
{'∨','∨'},
{'ª','ª'},
{'º','º'},
{'Ø','Ø'},
{'ø','ø'},
{'Õ','Õ'},
{'õ','õ'},
{'⊗','⊗'},
{'Ö','Ö'},
{'ö','ö'},
{'¶','¶'},
{'∂','∂'},
{'‰','‰'},
{'⊥','⊥'},
{'φ','φ'},
{'Φ','Φ'},
{'Π','Π'},
{'π','π'},
{'ϖ','ϖ'},
{'±','±'},
{'£','£'},
{'″','″'},
{'′','′'},
{'∏','∏'},
{'∝','∝'},
{'ψ','ψ'},
{'Ψ','Ψ'},
{'"','"'},
{'√','√'},
{'〉','〉'},
{'»','»'},
{'⇒','⇒'},
{'→','→'},
{'⌉','⌉'},
{'”','”'},
{'ℜ','ℜ'},
{'®','®'},
{'⌋','⌋'},
{'Ρ','Ρ'},
{'ρ','ρ'},
{'‏','‏'},
{'›','›'},
{'’','’'},
{'‚','‚'},
{'Š','Š'},
{'š','š'},
{'⋅','⋅'},
{'§','§'},
{'­','­'},
{'Σ','Σ'},
{'σ','σ'},
{'ς','ς'},
{'∼','∼'},
{'♠','♠'},
{'⊂','⊂'},
{'⊆','⊆'},
{'∑','∑'},
{'⊃','⊃'},
{'¹','¹'},
{'²','²'},
{'³','³'},
{'⊇','⊇'},
{'ß','ß'},
{'Τ','Τ'},
{'τ','τ'},
{'∴','∴'},
{'Θ','Θ'},
{'θ','θ'},
{'ϑ','ϑ'},
{' ',' '},
{'Þ','Þ'},
{'þ','þ'},
{'˜','˜'},
{'×','×'},
{'™','™'},
{'ú','ú'},
{'Ú','Ú'},
{'⇑','⇑'},
{'↑','↑'},
{'û','û'},
{'Û','Û'},
{'Ù','Ù'},
{'ù','ù'},
{'¨','¨'},
{'ϒ','ϒ'},
{'υ','υ'},
{'Υ','Υ'},
{'ü','ü'},
{'Ü','Ü'},
{'℘','℘'},
{'ξ','ξ'},
{'Ξ','Ξ'},
{'ý','ý'},
{'Ý','Ý'},
{'¥','¥'},
{'ÿ','ÿ'},
{'Ÿ','Ÿ'},
{'Ζ','Ζ'},
{'ζ','ζ'},

        };
        #endregion
        #region HTMLEntities
        SortedList<char, string> Entities = new SortedList<char, string>() {{'Á',"&Aacute;"},
                        {'\'',"&#39;"},
                        {'á',"&aacute;"},
                        {'â',"&acirc;"},
                        {'Â',"&Acirc;"},
                        {'´',"&acute;"},
                        {'æ',"&aelig;"},
                        {'Æ',"&AElig;"},
                        {'À',"&Agrave;"},
                        {'à',"&agrave;"},
                        {'ℵ',"&alefsym;"},
                        {'Α',"&Alpha;"},
                        {'α',"&alpha;"},
                        {'&',"&amp;"},
                        {'∧',"&and;"},
                        {'∠',"&ang;"},
                        {'å',"&aring;"},
                        {'Å',"&Aring;"},
                        {'≈',"&asymp;"},
                        {'Ã',"&Atilde;"},
                        {'ã',"&atilde;"},
                        {'Ä',"&Auml;"},
                        {'ä',"&auml;"},
                        {'„',"&bdquo;"},
                        {'Β',"&Beta;"},
                        {'β',"&beta;"},
                        {'¦',"&brvbar;"},
                        {'•',"&bull;"},
                        {'∩',"&cap;"},
                        {'Ç',"&Ccedil;"},
                        {'ç',"&ccedil;"},
                        {'¸',"&cedil;"},
                        {'¢',"&cent;"},
                        {'χ',"&chi;"},
                        {'Χ',"&Chi;"},
                        {'ˆ',"&circ;"},
                        {'♣',"&clubs;"},
                        {'≅',"&cong;"},
                        {'©',"&copy;"},
                        {'↵',"&crarr;"},
                        {'∪',"&cup;"},
                        {'¤',"&curren;"},
                        {'†',"&dagger;"},
                        {'‡',"&Dagger;"},
                        {'⇓',"&dArr;"},
                        {'↓',"&darr;"},
                        {'°',"&deg;"},
                        {'Δ',"&Delta;"},
                        {'δ',"&delta;"},
                        {'♦',"&diams;"},
                        {'÷',"&divide;"},
                        {'é',"&eacute;"},
                        {'É',"&Eacute;"},
                        {'Ê',"&Ecirc;"},
                        {'ê',"&ecirc;"},
                        {'è',"&egrave;"},
                        {'È',"&Egrave;"},
                        {'∅',"&empty;"},
                        {' ',"&emsp;"},
                        {' ',"&ensp;"},
                        {'ε',"&epsilon;"},
                        {'Ε',"&Epsilon;"},
                        {'≡',"&equiv;"},
                        {'Η',"&Eta;"},
                        {'η',"&eta;"},
                        {'ð',"&eth;"},
                        {'Ð',"&ETH;"},
                        {'ë',"&euml;"},
                        {'Ë',"&Euml;"},
                        {'€',"&euro;"},
                        {'∃',"&exist;"},
                        {'ƒ',"&fnof;"},
                        {'∀',"&forall;"},
                        {'½',"&frac12;"},
                        {'¼',"&frac14;"},
                        {'¾',"&frac34;"},
                        {'⁄',"&frasl;"},
                        {'Γ',"&Gamma;"},
                        {'γ',"&gamma;"},
                        {'≥',"&ge;"},
                        {'>',"&gt;"},
                        {'⇔',"&hArr;"},
                        {'↔',"&harr;"},
                        {'♥',"&hearts;"},
                        {'…',"&hellip;"},
                        {'í',"&iacute;"},
                        {'Í',"&Iacute;"},
                        {'î',"&icirc;"},
                        {'Î',"&Icirc;"},
                        {'¡',"&iexcl;"},
                        {'Ì',"&Igrave;"},
                        {'ì',"&igrave;"},
                        {'ℑ',"&image;"},
                        {'∞',"&infin;"},
                        {'∫',"&int;"},
                        {'Ι',"&Iota;"},
                        {'ι',"&iota;"},
                        {'¿',"&iquest;"},
                        {'∈',"&isin;"},
                        {'Ï',"&Iuml;"},
                        {'ï',"&iuml;"},
                        {'Κ',"&Kappa;"},
                        {'κ',"&kappa;"},
                        {'λ',"&lambda;"},
                        {'Λ',"&Lambda;"},
                        {'〈',"&lang;"},
                        {'«',"&laquo;"},
                        {'←',"&larr;"},
                        {'⇐',"&lArr;"},
                        {'⌈',"&lceil;"},
                        {'“',"&ldquo;"},
                        {'≤',"&le;"},
                        {'⌊',"&lfloor;"},
                        {'∗',"&lowast;"},
                        {'◊',"&loz;"},
                        {'‎',"&lrm;"},
                        {'‹',"&lsaquo;"},
                        {'‘',"&lsquo;"},
                        {'<',"&lt;"},
                        {'¯',"&macr;"},
                        {'—',"&mdash;"},
                        {'µ',"&micro;"},
                        {'·',"&middot;"},
                        {'−',"&minus;"},
                        {'Μ',"&Mu;"},
                        {'μ',"&mu;"},
                        {'∇',"&nabla;"},
                        {'1',"&1;"},
                        {'–',"&ndash;"},
                        {'≠',"&ne;"},
                        {'∋',"&ni;"},
                        {'¬',"&not;"},
                        {'∉',"&notin;"},
                        {'⊄',"&nsub;"},
                        {'ñ',"&ntilde;"},
                        {'Ñ',"&Ntilde;"},
                        {'Ν',"&Nu;"},
                        {'ν',"&nu;"},
                        {'ó',"&oacute;"},
                        {'Ó',"&Oacute;"},
                        {'Ô',"&Ocirc;"},
                        {'ô',"&ocirc;"},
                        {'Œ',"&OElig;"},
                        {'œ',"&oelig;"},
                        {'ò',"&ograve;"},
                        {'Ò',"&Ograve;"},
                        {'‾',"&oline;"},
                        {'ω',"&omega;"},
                        {'Ω',"&Omega;"},
                        {'Ο',"&Omicron;"},
                        {'ο',"&omicron;"},
                        {'⊕',"&oplus;"},
                        {'∨',"&or;"},
                        {'ª',"&ordf;"},
                        {'º',"&ordm;"},
                        {'Ø',"&Oslash;"},
                        {'ø',"&oslash;"},
                        {'Õ',"&Otilde;"},
                        {'õ',"&otilde;"},
                        {'⊗',"&otimes;"},
                        {'Ö',"&Ouml;"},
                        {'ö',"&ouml;"},
                        {'¶',"&para;"},
                        {'∂',"&part;"},
                        {'‰',"&permil;"},
                        {'⊥',"&perp;"},
                        {'φ',"&phi;"},
                        {'Φ',"&Phi;"},
                        {'Π',"&Pi;"},
                        {'π',"&pi;"},
                        {'ϖ',"&piv;"},
                        {'±',"&plusmn;"},
                        {'£',"&pound;"},
                        {'″',"&Prime;"},
                        {'′',"&prime;"},
                        {'∏',"&prod;"},
                        {'∝',"&prop;"},
                        {'ψ',"&psi;"},
                        {'Ψ',"&Psi;"},
                        {'"',"&quot;"},
                        {'√',"&radic;"},
                        {'〉',"&rang;"},
                        {'»',"&raquo;"},
                        {'⇒',"&rArr;"},
                        {'→',"&rarr;"},
                        {'⌉',"&rceil;"},
                        {'”',"&rdquo;"},
                        {'ℜ',"&real;"},
                        {'®',"&reg;"},
                        {'⌋',"&rfloor;"},
                        {'Ρ',"&Rho;"},
                        {'ρ',"&rho;"},
                        {'‏',"&rlm;"},
                        {'›',"&rsaquo;"},
                        {'’',"&rsquo;"},
                        {'‚',"&sbquo;"},
                        {'Š',"&Scaron;"},
                        {'š',"&scaron;"},
                        {'⋅',"&sdot;"},
                        {'§',"&sect;"},
                        {'­',"&shy;"},
                        {'Σ',"&Sigma;"},
                        {'σ',"&sigma;"},
                        {'ς',"&sigmaf;"},
                        {'∼',"&sim;"},
                        {'♠',"&spades;"},
                        {'⊂',"&sub;"},
                        {'⊆',"&sube;"},
                        {'∑',"&sum;"},
                        {'⊃',"&sup;"},
                        {'¹',"&sup1;"},
                        {'²',"&sup2;"},
                        {'³',"&sup3;"},
                        {'⊇',"&supe;"},
                        {'ß',"&szlig;"},
                        {'Τ',"&Tau;"},
                        {'τ',"&tau;"},
                        {'∴',"&there4;"},
                        {'Θ',"&Theta;"},
                        {'θ',"&theta;"},
                        {'ϑ',"&thetasym;"},
                        {' ',"&thinsp;"},
                        {'Þ',"&THORN;"},
                        {'þ',"&thorn;"},
                        {'˜',"&tilde;"},
                        {'×',"&times;"},
                        {'™',"&trade;"},
                        {'ú',"&uacute;"},
                        {'Ú',"&Uacute;"},
                        {'⇑',"&uArr;"},
                        {'↑',"&uarr;"},
                        {'û',"&ucirc;"},
                        {'Û',"&Ucirc;"},
                        {'Ù',"&Ugrave;"},
                        {'ù',"&ugrave;"},
                        {'¨',"&uml;"},
                        {'ϒ',"&upsih;"},
                        {'υ',"&upsilon;"},
                        {'Υ',"&Upsilon;"},
                        {'ü',"&uuml;"},
                        {'Ü',"&Uuml;"},
                        {'℘',"&weierp;"},
                        {'ξ',"&xi;"},
                        {'Ξ',"&Xi;"},
                        {'ý',"&yacute;"},
                        {'Ý',"&Yacute;"},
                        {'¥',"&yen;"},
                        {'ÿ',"&yuml;"},
                        {'Ÿ',"&Yuml;"},
                        {'Ζ',"&Zeta;"},
                        {'ζ',"&zeta;"},
        };
        #endregion
        #region Reversed entities
        private static SortedList<string, char> ReversedEntities = new SortedList<string, char>{
            {"&#039;",'\''},
            {"&Aacute;",'Á'},
{"&aacute;",'á'},
{"&acirc;",'â'},
{"&Acirc;",'Â'},
{"&acute;",'´'},
{"&aelig;",'æ'},
{"&AElig;",'Æ'},
{"&Agrave;",'À'},
{"&agrave;",'à'},
{"&alefsym;",'ℵ'},
{"&Alpha;",'Α'},
{"&alpha;",'α'},
{"&amp;",'&'},
{"&and;",'∧'},
{"&ang;",'∠'},
{"&aring;",'å'},
{"&Aring;",'Å'},
{"&asymp;",'≈'},
{"&Atilde;",'Ã'},
{"&atilde;",'ã'},
{"&Auml;",'Ä'},
{"&auml;",'ä'},
{"&bdquo;",'„'},
{"&Beta;",'Β'},
{"&beta;",'β'},
{"&brvbar;",'¦'},
{"&bull;",'•'},
{"&cap;",'∩'},
{"&Ccedil;",'Ç'},
{"&ccedil;",'ç'},
{"&cedil;",'¸'},
{"&cent;",'¢'},
{"&chi;",'χ'},
{"&Chi;",'Χ'},
{"&circ;",'ˆ'},
{"&clubs;",'♣'},
{"&cong;",'≅'},
{"&copy;",'©'},
{"&crarr;",'↵'},
{"&cup;",'∪'},
{"&curren;",'¤'},
{"&dagger;",'†'},
{"&Dagger;",'‡'},
{"&dArr;",'⇓'},
{"&darr;",'↓'},
{"&deg;",'°'},
{"&Delta;",'Δ'},
{"&delta;",'δ'},
{"&diams;",'♦'},
{"&divide;",'÷'},
{"&eacute;",'é'},
{"&Eacute;",'É'},
{"&Ecirc;",'Ê'},
{"&ecirc;",'ê'},
{"&egrave;",'è'},
{"&Egrave;",'È'},
{"&empty;",'∅'},
{"&emsp;",' '},
{"&ensp;",' '},
{"&epsilon;",'ε'},
{"&Epsilon;",'Ε'},
{"&equiv;",'≡'},
{"&Eta;",'Η'},
{"&eta;",'η'},
{"&eth;",'ð'},
{"&ETH;",'Ð'},
{"&euml;",'ë'},
{"&Euml;",'Ë'},
{"&euro;",'€'},
{"&exist;",'∃'},
{"&fnof;",'ƒ'},
{"&forall;",'∀'},
{"&frac12;",'½'},
{"&frac14;",'¼'},
{"&frac34;",'¾'},
{"&frasl;",'⁄'},
{"&Gamma;",'Γ'},
{"&gamma;",'γ'},
{"&ge;",'≥'},
{"&gt;",'>'},
{"&hArr;",'⇔'},
{"&harr;",'↔'},
{"&hearts;",'♥'},
{"&hellip;",'…'},
{"&iacute;",'í'},
{"&Iacute;",'Í'},
{"&icirc;",'î'},
{"&Icirc;",'Î'},
{"&iexcl;",'¡'},
{"&Igrave;",'Ì'},
{"&igrave;",'ì'},
{"&image;",'ℑ'},
{"&infin;",'∞'},
{"&int;",'∫'},
{"&Iota;",'Ι'},
{"&iota;",'ι'},
{"&iquest;",'¿'},
{"&isin;",'∈'},
{"&Iuml;",'Ï'},
{"&iuml;",'ï'},
{"&Kappa;",'Κ'},
{"&kappa;",'κ'},
{"&lambda;",'λ'},
{"&Lambda;",'Λ'},
{"&lang;",'〈'},
{"&laquo;",'«'},
{"&larr;",'←'},
{"&lArr;",'⇐'},
{"&lceil;",'⌈'},
{"&ldquo;",'“'},
{"&le;",'≤'},
{"&lfloor;",'⌊'},
{"&lowast;",'∗'},
{"&loz;",'◊'},
{"&lrm;",'‎'},
{"&lsaquo;",'‹'},
{"&lsquo;",'‘'},
{"&lt;",'<'},
{"&macr;",'¯'},
{"&mdash;",'—'},
{"&micro;",'µ'},
{"&middot;",'·'},
{"&minus;",'−'},
{"&Mu;",'Μ'},
{"&mu;",'μ'},
{"&nabla;",'∇'},
{"&1;",'1'},
{"&ndash;",'–'},
{"&ne;",'≠'},
{"&ni;",'∋'},
{"&not;",'¬'},
{"&notin;",'∉'},
{"&nsub;",'⊄'},
{"&ntilde;",'ñ'},
{"&Ntilde;",'Ñ'},
{"&Nu;",'Ν'},
{"&nu;",'ν'},
{"&oacute;",'ó'},
{"&Oacute;",'Ó'},
{"&Ocirc;",'Ô'},
{"&ocirc;",'ô'},
{"&OElig;",'Œ'},
{"&oelig;",'œ'},
{"&ograve;",'ò'},
{"&Ograve;",'Ò'},
{"&oline;",'‾'},
{"&omega;",'ω'},
{"&Omega;",'Ω'},
{"&Omicron;",'Ο'},
{"&omicron;",'ο'},
{"&oplus;",'⊕'},
{"&or;",'∨'},
{"&ordf;",'ª'},
{"&ordm;",'º'},
{"&Oslash;",'Ø'},
{"&oslash;",'ø'},
{"&Otilde;",'Õ'},
{"&otilde;",'õ'},
{"&otimes;",'⊗'},
{"&Ouml;",'Ö'},
{"&ouml;",'ö'},
{"&para;",'¶'},
{"&part;",'∂'},
{"&permil;",'‰'},
{"&perp;",'⊥'},
{"&phi;",'φ'},
{"&Phi;",'Φ'},
{"&Pi;",'Π'},
{"&pi;",'π'},
{"&piv;",'ϖ'},
{"&plusmn;",'±'},
{"&pound;",'£'},
{"&Prime;",'″'},
{"&prime;",'′'},
{"&prod;",'∏'},
{"&prop;",'∝'},
{"&psi;",'ψ'},
{"&Psi;",'Ψ'},
{"&quot;",'"'},
{"&radic;",'√'},
{"&rang;",'〉'},
{"&raquo;",'»'},
{"&rArr;",'⇒'},
{"&rarr;",'→'},
{"&rceil;",'⌉'},
{"&rdquo;",'”'},
{"&real;",'ℜ'},
{"&reg;",'®'},
{"&rfloor;",'⌋'},
{"&Rho;",'Ρ'},
{"&rho;",'ρ'},
{"&rlm;",'‏'},
{"&rsaquo;",'›'},
{"&rsquo;",'’'},
{"&sbquo;",'‚'},
{"&Scaron;",'Š'},
{"&scaron;",'š'},
{"&sdot;",'⋅'},
{"&sect;",'§'},
{"&shy;",'­'},
{"&Sigma;",'Σ'},
{"&sigma;",'σ'},
{"&sigmaf;",'ς'},
{"&sim;",'∼'},
{"&spades;",'♠'},
{"&sub;",'⊂'},
{"&sube;",'⊆'},
{"&sum;",'∑'},
{"&sup;",'⊃'},
{"&sup1;",'¹'},
{"&sup2;",'²'},
{"&sup3;",'³'},
{"&supe;",'⊇'},
{"&szlig;",'ß'},
{"&Tau;",'Τ'},
{"&tau;",'τ'},
{"&there4;",'∴'},
{"&Theta;",'Θ'},
{"&theta;",'θ'},
{"&thetasym;",'ϑ'},
{"&thinsp;",' '},
{"&THORN;",'Þ'},
{"&thorn;",'þ'},
{"&tilde;",'˜'},
{"&times;",'×'},
{"&trade;",'™'},
{"&uacute;",'ú'},
{"&Uacute;",'Ú'},
{"&uArr;",'⇑'},
{"&uarr;",'↑'},
{"&ucirc;",'û'},
{"&Ucirc;",'Û'},
{"&Ugrave;",'Ù'},
{"&ugrave;",'ù'},
{"&uml;",'¨'},
{"&upsih;",'ϒ'},
{"&upsilon;",'υ'},
{"&Upsilon;",'Υ'},
{"&uuml;",'ü'},
{"&Uuml;",'Ü'},
{"&weierp;",'℘'},
{"&xi;",'ξ'},
{"&Xi;",'Ξ'},
{"&yacute;",'ý'},
{"&Yacute;",'Ý'},
{"&yen;",'¥'},
{"&yuml;",'ÿ'},
{"&Yuml;",'Ÿ'},
{"&Zeta;",'Ζ'},
{"&zeta;",'ζ'},
            };
        #endregion
        public enum ReplaceType
        {
            HtmlEntity,
            CharacterCode,
            Both
        }
        public string HtmlSpecialChars(string s)
        {
            foreach (char c in s.ToCharArray().Distinct().ToArray())
                if (Chars.ContainsKey(c))
                    s = s.Replace(c.ToString(), Entities[c]);
            return s;
        }
        public string HtmlSpecialCharsDecode(string s)
        {
            return HtmlSpecialCharsDecode(s, ReplaceType.Both);
        }
        public string HtmlSpecialCharsDecode(string s, ReplaceType r)
        {
            if (r == ReplaceType.CharacterCode || r == ReplaceType.Both)
                s = numeric.Replace(s, new MatchEvaluator(rep));
            if (r == ReplaceType.HtmlEntity || r == ReplaceType.Both)
                foreach (var x in ReversedEntities.Keys.Where(o => s.Contains(o)).ToArray())
                    s = s.Replace(x, ReversedEntities[x].ToString());
            return s;
        }
        public string UrlDecode(string s)
        {
            return urlhex.Replace(s, new MatchEvaluator(rep2));
        }
        public string UrlEncode(string s)
        {
            return "%" + BitConverter.ToString(Encoding.UTF8.GetBytes(s)).Replace('-', '%');
        }
        string rep2(Match m)
        {
            string s = m.ToString();
            s = Convert.ToChar(int.Parse(s.Substring(2, s.Length - 3), System.Globalization.NumberStyles.HexNumber)).ToString();
            return s;
        }
        string rep(Match m)
        {
            string s = m.ToString();
            s = Convert.ToChar(int.Parse(s.Substring(2, s.Length - 3))).ToString();
            return s;
        }
    }
}